<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <meta name="color-scheme" content="dark"> -->
    <title>Case Library | Ecology and Culture Lab</title>

    <style>
        @font-face {
            font-family: AvenirNext;
            src: url("avenir-next/AvenirNextLTPro-Regular.otf") format("opentype");
        }

        @font-face {
            font-family: AvenirNext;
            font-weight: bold;
            src: url("avenir-next/AvenirNextLTPro-Bold.otf") format("opentype");
        }

        @font-face {
            font-family: AvenirNext;
            font-style: italic;
            src: url("avenir-next/AvenirNextLTPro-It.otf") format("opentype");
        }

        :root {
            --border-style: 1px solid var(--color-foreground);
            --padding-val: 0.5rem;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: AvenirNext;
            margin: 0;
        }

        img {
            max-width: 100%;
        }

        a {
            word-break: break-all;
            /* color: var(--color-accent); */
        }

        /* a:link {
        } */

        button,
        summary {
            cursor: pointer;
        }

        button {
            border: var(--border-style);
            background-color: var(--color-background);
        }

        button:hover {
            background-color: var(--color-foreground);
            color: var(--color-background);
        }
    </style>

    <style>
        :root {
            --color-background: white;
            --color-foreground: black;
        }

        .dark:root {
            --color-background: #24283b;
            --color-background-dark: #1a1b26;
            --color-background-light: #414868;
            --color-foreground: #a9b1d6;
            --color-foreground-light: #c0caf5;
            --color-accent: #e0af68;
        }

        body {
            background-color: var(--color-background);
            color: var(--color-foreground);
            accent-color: var(--color-accent);
        }

        .filter-selector {
            background-color: var(--color-background-light);
        }

        .filter-selector b {
            color: var(--color-foreground-light);
        }

        .filter-selector label:hover {
            color: var(--color-foreground-light);
        }

        .filter-selector summary {
            /* font-weight: bold; */
            color: var(--color-foreground-light);
        }

        .projects h3 {
            color: var(--color-foreground-light);
        }
    </style>

    <style>
        header img {
            max-width: 20rem;
        }

        .filter-selector,
        .filter-selector details {
            display: flex;
            flex-direction: column;
        }

        .filter-selector label,
        .filter-selector summary {
            margin-top: var(--padding-val);
        }

        .filter-selector label {
            cursor: pointer;
        }

        .projects>div {
            /* background-color: var(--color-background); */
            margin-top: var(--padding-val);
            /* padding: var(--padding-val); */
            border-bottom: var(--border-style);
        }

        main {
            position: relative;
        }

        .filter-selector,
        .filter-line {
            position: sticky;
            top: 0;
            padding-top: var(--padding-val);
            padding-bottom: var(--padding-val);
        }

        .filter-line {
            background-color: var(--color-background);
            /* font-weight: bold; */
            border-bottom: var(--border-style);
        }

        .filter-line button {
            font-weight: bold;
            /* font-size: large; */
            margin-left: var(--padding-val);
        }

        .projects>div,
        .wrapper {
            padding-left: var(--padding-val);
            padding-right: var(--padding-val);
        }

        header {
            padding-top: var(--padding-val);
        }

        @media (min-width: 600px) {
            /* header p {
                max-width: 80ch;
            } */

            main {
                display: flex;
                gap: var(--padding-val);
            }

            main aside {
                flex-shrink: 0;
                flex-basis: 25ch;
                /* border-right: var(--border-style); */
            }

            /* .projects {
                max-width: 80ch;
            } */

            /* .filter-selector {
                border-right: var(--border-style);
            } */
        }
    </style>

    <script src="cells.js"></script>

    <script>
        const ce = name => document.createElement(name);
        const qs = (query, parent = document) => parent.querySelector(query);
        const qsa = (query, parent = document) => parent.querySelectorAll(query);

        ['div', 'p', 'span', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'a', 'ul',
            'li', 'details', 'summary', 'nav', 'header', 'button', 'blockquote',
            'main', 'aside', 'label', 'b', 'u'
        ].forEach(name =>
            window[name] = (...children) => {
                const el = ce(name)
                el.append(...children)
                return el
            })

        const { assign } = Object
        const img = filename => assign(ce('img'), { src: filename })
        const input = type => assign(ce('input'), { type: type })
    </script>
</head>

<body>
    <script>
        'use strict'

        const rows = cells.values
        const headers = rows[0]
        const entries = rows.slice(3)

        const i_ubran_context = 6
        const i_citizen_science = 7
        const i_nature_topics = 8
        const i_technoloies = 9
        const i_other_keywords = 10
        const i_implimentation = 11

        const technology_catagories = [
            'AI',
            'AR',
            'Biomedia',
            'Biotech',
            'Coding',
            'Data',
            'Digital Fabrication',
            'Fabrication',
            'Sampling',
            'Sensor',
            'Sound',
            'VR',
        ]

        const head = header(
            img('./EAD.png'),
            h1('Welcome to the Ecology and Culture Lab'),
            p('This page is an open dataset of classified cases about currnet tech applications of AI, data science and digital fabrication that are already in place to serve nature and human re-connection within the city.'),
        )

        const projs = div()

        const urban_context_count = entries.filter(e => apply_filter('Urban Context'))
        const citizen_science_count = entries.filter(e => apply_filter('Citizen Science'))

        const filter_selector = div(
            b('Filter'),

            filter_checkbox_element('Urban Context'),
            filter_checkbox_element('Citizen Science'),

            details(
                summary('Technology'),
                ...technology_catagories.map(catagroy_name =>
                    filter_checkbox_element(catagroy_name))
            ),

            details(
                summary('Nature Topic'),
                label(input('checkbox'), 'Biodiversity'),
                label(input('checkbox'), 'Five Elements'),
            ),

            details(
                summary('Implementation'),
                label(input('checkbox'), 'Complete'),
                label(input('checkbox'), 'Prototype'),
                label(input('checkbox'), 'Speculative'),
            ),
        )

        const filter_line = div()

        const checkboxes = [...filter_selector.querySelectorAll('input[type="checkbox"]')]
        checkboxes.forEach(checkbox => {
            checkbox.onchange = update_filter
        })

        const main_container = main(
            aside(filter_selector),
            div(
                filter_line,
                projs,
            ),
        )
        // qsa('details', main_container)
        //     .forEach(e => e.setAttribute('open', ''))

        projs.classList.add('projects')
        filter_selector.classList.add('filter-selector')
        filter_line.classList.add('filter-line')

        main_container.classList.add('wrapper')
        head.classList.add('wrapper')
        // projs.classList.add('wrapper')
        filter_selector.classList.add('wrapper')
        filter_line.classList.add('wrapper')

        document.body.append(
            head,
            main_container,
        )

        update_filter()

        function filter_checkbox_element(filter) {
            return label(
                assign(input('checkbox'), {
                    value: filter,
                }),
                filter + ` (${entries.filter(e => apply_filter(e, filter)).length})`,
            )
        }

        function update_filter() {
            const filter_values = checkboxes
                .filter(c => c.checked)
                .map(c => c.value)

            if (filter_values.length === 0) {
                filter_line.replaceChildren(b(`Showing (${entries.length}): All Projects`))
                show_entries(entries)
            }
            else {
                const filtered_entries = filter_entries(entries, filter_values)
                filter_line.replaceChildren(
                    b(`Showing (${filtered_entries.length}):`),
                    assign(button('Clear Filter'), {
                        onclick() {
                            checkboxes.forEach(c => c.checked = false)
                            update_filter()
                        }
                    }),
                    ...filter_values.map(val => assign(
                        button('× ' + val), {
                        onclick() {
                            checkboxes.find(c => c.value === val).checked = false
                            update_filter()
                        }
                    }))
                )
                // filter_line.textContent = `Showing (${filtered_entries.length}): ${filter_values.join(', ')}`
                show_entries(filtered_entries)
            }
        }

        function entry_get_tokens(entry, column_index) {
            return entry[column_index] ? entry[column_index].toLowerCase().split(',').map(s => s.trim()) : []
        }

        function apply_filter(entry, filter_val) {
            return (filter_val === 'Urban Context' && entry[i_ubran_context] === 'Y')
                || (filter_val === 'Citizen Science' && entry[i_citizen_science] === 'Y')
                || (technology_catagories.includes(filter_val) &&
                    entry_get_tokens(entry, i_technoloies).includes(filter_val.toLowerCase()))
        }

        function filter_entries(entries, filters) {
            if (filters.length === 0)
                return entries

            return entries.filter(row => {
                for (const filter_val of filters) {
                    if (apply_filter(row, filter_val))
                        return true
                }
                return false
            })
        }

        function show_entries(list) {
            projs.replaceChildren(
                ...list.map(([name, place, authors, year, link, description]) =>
                    div(
                        h3(name),
                        div(b('Place '), place),
                        div(b('Authors '), authors),
                        div(b('Year '), year),
                        div(b('Link '), assign(a(link), { href: link }),
                            blockquote(description ? description : ""),
                        ))
                ))
        }

    </script>
</body>

</html>