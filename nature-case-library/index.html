<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Library | Ecology and Culture Lab</title>

    <style>
        :root {
            --border-style: 1px solid currentColor;
            --padding-val: 0.5rem;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: AvenirNext;
            margin: 0;
        }

        img {
            max-width: 100%;
        }

        a {
            word-break: break-all;
        }

        button,
        summary {
            cursor: pointer;
        }

        @font-face {
            font-family: AvenirNext;
            src: url("avenir-next/AvenirNextLTPro-Regular.otf") format("opentype");
        }

        @font-face {
            font-family: AvenirNext;
            font-weight: bold;
            src: url("avenir-next/AvenirNextLTPro-Bold.otf") format("opentype");
        }

        @font-face {
            font-family: AvenirNext;
            font-style: italic;
            src: url("avenir-next/AvenirNextLTPro-It.otf") format("opentype");
        }
    </style>

    <style>
        header img {
            max-width: 20rem;
        }

        header p {
            max-width: 80ch;
        }

        .filter-selector {
            display: flex;
            flex-direction: column;
            border-right: var(--border-style);
        }

        .filter-selector>* {
            margin-bottom: var(--padding-val);
        }

        .filter-selector summary {
            font-weight: bold;
        }

        .filter-selector label {
            cursor: pointer;
        }

        .filter-selector details ul {
            list-style-type: none;
            padding-left: var(--padding-val);
            margin: var(--padding-val) 0;
        }

        .projects>div {
            border-bottom: var(--border-style);
        }

        main {
            position: relative;
        }

        .filter-selector,
        .filter-line {
            position: sticky;
            top: 0;
            padding-top: var(--padding-val);
            padding-bottom: var(--padding-val);
        }

        .filter-line {
            background-color: white;
            font-weight: bold;
            border-bottom: var(--border-style);
        }

        .wrapper {
            padding-left: var(--padding-val);
            padding-right: var(--padding-val);
        }

        header {
            padding-top: var(--padding-val);
        }

        @media (min-width: 600px) {
            main {
                display: flex;
            }

            main aside {
                flex-shrink: 0;
                flex-basis: 25ch;
            }
        }
    </style>

    <script src="cells.js"></script>

    <script>
        const ce = name => document.createElement(name);
        const qs = (query, parent = document) => parent.querySelector(query);
        const qsa = (query, parent = document) => parent.querySelectorAll(query);

        ['div', 'p', 'span', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
            'a', 'ul', 'li', 'details', 'summary', 'nav', 'header',
            'button', 'blockquote', 'main', 'aside', 'label', 'b'
        ].forEach(name =>
            window[name] = (...children) => {
                const el = ce(name)
                el.append(...children)
                return el
            })

        const { assign } = Object
        const img = filename => assign(ce('img'), { src: filename })
        const input = type => assign(ce('input'), { type: type })
    </script>
</head>

<body>
    <script>
        'use strict'

        /*
        sheet headers
        [
            "Project Name",
            "Place",
            "Authors",
            "Year",
            "Link",
            "Description ",
            "Does this project has to do with urban context? Y/N",
            "Is it a Citizen Science project?",
            "Nature topic",
            "Technology ",
            "Other Keywords",
            "Implementation",
            "student name",
            "Why is related/relevant to our ecology conversation / / why this inspre you?"
        ]
        */

        const rows = cells.values
        const headers = rows[0]
        const entries = rows.slice(3)

        const technology_catagories = [
            'AI',
            'Data',
            'Fabrication',
            'Digital Fabrication',
            'Sensor',
            'Sampling',
            'Coding',
            'Biomedia',
        ]

        const i_ubran_context = headers.indexOf('Does this project has to do with urban context? Y/N')
        const i_citizen_science = i_ubran_context + 1
        const i_nature_topics = i_ubran_context + 2
        const i_technoloies = i_ubran_context + 3
        const i_other_keywords = i_ubran_context + 4
        const i_implimentation = i_ubran_context + 5

        const normalize_tags = str => str ? str.toLowerCase().split(',').map(s => s.trim()) : []

        const [topics, show_topics] = gen_tag_selector('Nature Topics', i_nature_topics, plural => `Nature Topic${plural ? 's' : ''}`)
        const [techs, show_techs] = gen_tag_selector('Technologies', i_technoloies, plural => `Technolog${plural ? 'ies' : 'y'}`)
        const [keywords, show_keywords] = gen_tag_selector('Keywords', i_other_keywords, plural => `Keyword${plural ? 's' : ''}`)
        const [impls, show_impls] = gen_tag_selector('Implementations', i_implimentation, plural => `Implementation${plural ? 's' : ''}`)

        const head = header(
            img('./EAD.png'),
            h1('Welcome to the Ecology and Culture Lab'),
            p('This page is an open dataset of classified cases about currnet tech applications of AI, data science and digital fabrication that are already in place to serve nature and human re-connection within the city.'),
        )

        const current_filter = h2()
        const projs = div()

        const filter_selector = div(
            b('Filter'),

            label(input('checkbox'), 'Urban Context'),
            label(input('checkbox'), 'Citizen Science'),

            details(
                summary('Technology'),
                ul(...technology_catagories.map(catagroy_name =>
                    li(label(input('checkbox'), catagroy_name))))
            ),

            details(
                summary('Nature Topic'),
                ul(
                    li(label(input('checkbox'), 'Biodiversity')),
                    li(label(input('checkbox'), 'Five Elements')),
                )
            ),

            details(
                summary('Implementation'),
                ul(
                    li(label(input('checkbox'), 'Complete')),
                    li(label(input('checkbox'), 'Prototype')),
                    li(label(input('checkbox'), 'Speculative')),
                )
            ),
        )

        const filter_line = div('Showing: All projects')

        const main_container = main(
            aside(filter_selector),
            div(
                filter_line,
                projs,
            )
        )
        qsa('details', main_container)
            .forEach(e => e.setAttribute('open', ''))

        projs.classList.add('projects')
        filter_selector.classList.add('filter-selector')
        filter_line.classList.add('filter-line')

        head.classList.add('wrapper')
        projs.classList.add('wrapper')
        filter_selector.classList.add('wrapper')
        filter_line.classList.add('wrapper')

        document.body.append(
            head,
            main_container,
        )

        show_all()

        function show_all() {
            current_filter.textContent = `Showing: All Projects`
            show_entries(entries)
        }

        function show_entries(list) {
            projs.replaceChildren(
                ...list.map(([name, place, authors, year, link, description]) =>
                    div(
                        h3(name),
                        div(b('Place '), place),
                        div(b('Authors '), authors),
                        div(b('Year '), year),
                        div(b('Link '), assign(a(link), { href: link }),
                            blockquote(description ? description : ""),
                        ))
                ))
        }

        function gen_tag_selector(heading, col_index, filter_str) {
            const tags = [...new Set(entries.map(row => normalize_tags(row[col_index])).flat().filter(t => t))]
            const selected = new Set()

            const elem = details(
                summary(h3(heading)),
                assign(button('Clear'), {
                    onclick() {
                        selected.clear()
                        elem.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'))
                        show_function()
                    }
                }),
                ...tags.map(tag =>
                    assign(button(tag), {
                        onclick() {
                            if (selected.has(tag)) {
                                selected.delete(tag)
                                this.classList.remove('selected')
                            }
                            else {
                                selected.add(tag)
                                this.classList.add('selected')
                            }
                            show_function()
                        }
                    })
                )
            )
            elem.classList.add('tag-selector')

            function show_function() {
                const items = entries.filter(row => {
                    const row_tags = normalize_tags(row[col_index])
                    for (const tag of selected.keys())
                        if (row_tags?.includes(tag)) return true
                    return false
                })
                current_filter.textContent = `Showing: ${filter_str(selected.size > 1)}: ${[...selected].join(', ')}`
                show_entries(items)
            }

            return [elem, show_function]
        }
    </script>
</body>

</html>